"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[893],{6530:(t,a,e)=>{e.d(a,{W3:()=>r,Ue:()=>o,$Z:()=>n,Vx:()=>l});var i=e(4319);function r(t){return(0,i.Z)({url:"/WebNav/category",method:"get",params:t})}function o(t){return(0,i.Z)({url:"/WebNav/category",method:"post",data:t})}function n(t){return(0,i.Z)({url:"/WebNav/category/"+t,method:"get"})}function l(t,a){return(0,i.Z)({url:"/WebNav/category/"+t,method:"put",data:a})}},3893:(t,a,e)=>{e.r(a),e.d(a,{default:()=>s});var i=e(4319);var r=e(113),o=e(1203),n=e(6530);const l={props:{category_id:{type:Number,default:""}},data:function(){return{headers:{},action:"",uploadData:{},createNavigationVisible:!1,updateNavigationVisible:!1,navigation_options:[],loading:!1,tableData:[],createLoading:!1,updateLoading:!1,createError:{},updateError:{},imageUrlPreview:"",editImageUrlPreview:"",category_options:[],createNavigationForm:{name:"",url:"",category_id:"",image_path:"",description:"",published:!0,sort:0,target:"_blank"},updateNavigationForm:{id:"",name:"",url:"",category_id:"",image_path:"",description:"",target:"_blank",published:"",sort:""}}},watch:{category_id:function(){this.getNavigation()}},mounted:function(){this.setAction(),this.setHeader(),this.getCategory(),this.getNavigation()},methods:{updateNavigation:function(t){var a=this;this.updateError={},this.updateLoading=!0;var e,r,o=this.updateNavigationForm.category_id;o instanceof Array&&(this.updateNavigationForm.category_id=o.slice(-1)[0]),(e=this.updateNavigationForm.id,r=this.updateNavigationForm,(0,i.Z)({url:"/WebNav/navigation/"+e,method:"put",data:r})).then((function(e){a.$message({message:e.message,type:"success"}),a.updateNavigationVisible=!1,a.getNavigation(),a.resetCreateForm(t)})).catch((function(t){var e=t.data;422===t.code&&(a.updateError=e)})).finally((function(){a.updateLoading=!1}))},handleEdit:function(t){var a,e=this;this.updateError={},(a=t.id,(0,i.Z)({url:"/WebNav/navigation/"+a,method:"get"})).then((function(t){var a=t.data;e.updateNavigationVisible=!0,e.updateNavigationForm=a;var i;i=e.parentData([],a.category_id,e.category_options),e.updateNavigationForm.category_id=0==i.length?[0]:i,e.updateLoading=!1,e.editImageUrlPreview=(0,o.UO)()+a.image_path}))},handleRemove:function(t){var a=this;this.$confirm("确定要删除么？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){var e;(e=t.id,(0,i.Z)({url:"/WebNav/navigation/"+e,method:"delete"})).then((function(){a.$message({type:"success",message:"删除成功!"}),a.getNavigation()})).catch((function(t){var e=t.response.data;200!==e.code&&a.$message({type:"info",message:e.message})}))})).catch((function(){a.$message({type:"info",message:"取消删除"})}))},parentData:function(t,a,e){var i=this;return e.forEach((function(e){a==e.id?0!=a&&(t.unshift(e.id),i.parentData(t,e.parent_id,i.category_options)):e.children instanceof Array&&i.parentData(t,a,e.children)})),t},setHeader:function(){this.headers={Authorization:"Bearer "+(0,r.LP)()}},setAction:function(){this.action=(0,o.Vy)()+"/WebNav/file/upload"},successUpload:function(t,a,e){this.imageUrlPreview=(0,o.UO)()+t.data.path,this.createNavigationForm.image_path=t.data.path},beforeUpload:function(t){this.uploadData.directory="/navigation",this.uploadData.name=t.name},successUploadEdit:function(t,a,e){this.editImageUrlPreview="",this.editImageUrlPreview=(0,o.UO)()+t.data.path,this.updateNavigationForm.image_path=t.data.path},beforeUploadEdit:function(t){this.uploadData.directory="/navigation",this.uploadData.name=t.name},resetCreateForm:function(t){this.$refs[t].resetFields()},createNavigation:function(t){var a=this;this.createLoading=!0,this.createError={};var e,r=this.createNavigationForm.category_id;r instanceof Array&&(this.createNavigationForm.category_id=r.slice(-1)[0]),(e=this.createNavigationForm,(0,i.Z)({url:"/WebNav/navigation",method:"post",data:e})).then((function(e){a.$message({message:e.message,type:"success"}),a.resetCreateForm(t),a.getNavigation(),a.createNavigationVisible=!1})).catch((function(t){var e=t.data;422===t.code&&(a.createError=e)})).finally((function(){a.createLoading=!1}))},getNavigation:function(){var t=this;this.loading=!0,this.createNavigationForm.category_id=this.category_id;var a,e={category_id:this.category_id};(a=e,(0,i.Z)({url:"/WebNav/navigation",method:"get",params:a})).then((function(a){var e=a.data;t.loading=!1,t.tableData=JSON.parse(JSON.stringify(e.navigation)),t.navigation_options=JSON.parse(JSON.stringify(e.navigation)),t.navigation_options.unshift({id:0,name:"顶级导航"})})).catch((function(a){t.loading=!1,t.tableData=[],t.total=0}))},getCategory:function(){var t=this;this.loading=!0;(0,n.W3)({}).then((function(a){var e=a.data;t.loading=!1,t.category_options=e.category})).catch((function(a){t.loading=!1,t.tableData=[],t.total=0}))}}};const s=(0,e(1900).Z)(l,(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(a){t.createNavigationVisible=!0}}},[e("i",{staticClass:"el-icon-plus"}),t._v(" 添加导航\n    ")]),t._v(" "),e("div",{staticClass:"material_list",staticStyle:{top:"50px"}},[e("el-scrollbar",[e("div",{staticClass:"scrollbar-table"},[e("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.tableData,"tooltip-effect":"dark"}},[e("el-table-column",{attrs:{prop:"name","show-overflow-tooltip":!0,"min-width":"15%",label:"名称",align:"left"}}),t._v(" "),e("el-table-column",{attrs:{prop:"url","show-overflow-tooltip":!0,"min-width":"15%",label:"地址",align:"left"}}),t._v(" "),e("el-table-column",{attrs:{prop:"published","show-overflow-tooltip":!0,"min-width":"15%",label:"是否发布"},scopedSlots:t._u([{key:"default",fn:function(a){return[1==a.row.published?e("el-tag",{staticStyle:{margin:"0 3px"},attrs:{type:"success",size:"small"}},[t._v("已发布\n                            ")]):e("el-tag",{staticStyle:{margin:"0 3px"},attrs:{type:"info",size:"small"}},[t._v("未发布")])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"分类","show-overflow-tooltip":!0,"min-width":"15%",label:"类型"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-tag",{staticStyle:{margin:"0 3px"},attrs:{size:"small"}},[t._v("\n                                "+t._s(null!=a.row.category&&a.row.category.hasOwnProperty("name")?a.row.category.name:"无")+"\n                            ")])]}}])}),t._v(" "),e("el-table-column",{attrs:{align:"center",label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text",title:"编辑"},on:{click:function(e){return t.handleEdit(a.row)}}},[e("i",{staticClass:"el-icon-edit"})]),t._v(" "),e("el-button",{attrs:{title:"删除",type:"text"},on:{click:function(e){return t.handleRemove(a.row)}}},[e("i",{staticClass:"el-icon-delete"})])]}}])})],1)],1)]),t._v(" "),e("el-dialog",{attrs:{"custom-class":"dialog_tc",title:"创建",visible:t.createNavigationVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(a){t.createNavigationVisible=a}}},[e("el-form",{ref:"createForm",attrs:{model:t.createNavigationForm,"label-width":"80px",size:"medium"}},[e("el-form-item",{attrs:{label:"所属分类",prop:"category_id",error:t.createError.category_id?t.createError.category_id[0]:""}},[e("el-cascader",{attrs:{options:t.category_options,clearable:"",filterable:"",props:{checkStrictly:!0,label:"name",value:"id",expandTrigger:"click"},placeholder:"请选择所属分类"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.node,r=a.data;return[e("span",[t._v(t._s(r.name))]),t._v(" "),i.isLeaf?t._e():e("span",[t._v(" ("+t._s(r.children.length)+") ")])]}}]),model:{value:t.createNavigationForm.category_id,callback:function(a){t.$set(t.createNavigationForm,"category_id",a)},expression:"createNavigationForm.category_id"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"name",label:"导航名称",required:"",error:t.createError.name?t.createError.name[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航名称"},model:{value:t.createNavigationForm.name,callback:function(a){t.$set(t.createNavigationForm,"name",a)},expression:"createNavigationForm.name"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"url",label:"导航网址",error:t.createError.url?t.createError.url[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"例：www.zealov.com"},model:{value:t.createNavigationForm.url,callback:function(a){t.$set(t.createNavigationForm,"url",a)},expression:"createNavigationForm.url"}})],1),t._v(" "),e("el-form-item",{staticClass:"upload_thumb",attrs:{label:"缩略图",prop:"image_path"}},[e("el-upload",{staticClass:"uploadThumbImg",attrs:{headers:t.headers,action:t.action,"show-file-list":!1,"on-success":t.successUpload,"before-upload":t.beforeUpload,data:t.uploadData}},[t.createNavigationForm.image_path?e("img",{staticClass:"thumb",attrs:{src:t.imageUrlPreview}}):e("i",{staticClass:"el-icon-plus"})]),t._v(" "),e("div",{staticClass:"el-upload__tip"},[t._v("\n                        支持JPG/PNG格式，建议尺寸800*450px或16:9\n                        "),e("br"),t._v("图片大小不超过1MB\n                    ")])],1),t._v(" "),e("el-form-item",{attrs:{prop:"description",label:"简介",error:t.createError.description?t.createError.description[0]:""}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入简介",maxlength:"500","show-word-limit":"",rows:3},model:{value:t.createNavigationForm.description,callback:function(a){t.$set(t.createNavigationForm,"description",a)},expression:"createNavigationForm.description"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"published",label:"状态",error:t.createError.published?t.createError.published[0]:""}},[e("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.createNavigationForm.published,callback:function(a){t.$set(t.createNavigationForm,"published",a)},expression:"createNavigationForm.published"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.createNavigationVisible=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary",loading:t.createLoading},on:{click:function(a){return t.createNavigation("createForm")}}},[t._v("保存")])],1)],1),t._v(" "),e("el-dialog",{attrs:{"custom-class":"dialog_tc",title:"修改",visible:t.updateNavigationVisible,width:"560px","close-on-click-modal":!1},on:{"update:visible":function(a){t.updateNavigationVisible=a}}},[e("el-form",{ref:"updateForm",attrs:{model:t.updateNavigationForm,"label-width":"80px",size:"medium"}},[e("el-form-item",{attrs:{label:"所属分类",prop:"category_id",error:t.updateError.category_id?t.updateError.category_id[0]:""}},[e("el-cascader",{attrs:{options:t.category_options,clearable:"",filterable:"",props:{checkStrictly:!0,label:"name",value:"id",expandTrigger:"click"},placeholder:"请选择所属分类"},scopedSlots:t._u([{key:"default",fn:function(a){var i=a.node,r=a.data;return[e("span",[t._v(t._s(r.name))]),t._v(" "),i.isLeaf?t._e():e("span",[t._v(" ("+t._s(r.children.length)+") ")])]}}]),model:{value:t.updateNavigationForm.category_id,callback:function(a){t.$set(t.updateNavigationForm,"category_id",a)},expression:"updateNavigationForm.category_id"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"name",label:"导航名称",required:"",error:t.updateError.name?t.updateError.name[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航名称"},model:{value:t.updateNavigationForm.name,callback:function(a){t.$set(t.updateNavigationForm,"name",a)},expression:"updateNavigationForm.name"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"url",label:"导航地址",error:t.updateError.url?t.updateError.url[0]:""}},[e("el-input",{attrs:{type:"text",placeholder:"请输入导航地址"},model:{value:t.updateNavigationForm.url,callback:function(a){t.$set(t.updateNavigationForm,"url",a)},expression:"updateNavigationForm.url"}})],1),t._v(" "),e("el-form-item",{staticClass:"upload_thumb",attrs:{label:"缩略图",prop:"image_path"}},[e("el-upload",{staticClass:"uploadThumbImg",attrs:{headers:t.headers,action:t.action,"show-file-list":!1,"on-success":t.successUploadEdit,"before-upload":t.beforeUploadEdit,data:t.uploadData}},[t.updateNavigationForm.image_path?e("img",{staticClass:"thumb",attrs:{src:t.editImageUrlPreview}}):e("i",{staticClass:"el-icon-plus"})]),t._v(" "),e("div",{staticClass:"el-upload__tip"},[t._v("\n                        支持JPG/PNG格式，建议尺寸800*450px或16:9\n                        "),e("br"),t._v("图片大小不超过1MB\n                    ")])],1),t._v(" "),e("el-form-item",{attrs:{prop:"description",label:"简介",error:t.updateError.description?t.updateError.description[0]:""}},[e("el-input",{attrs:{type:"textarea",placeholder:"请输入简介",maxlength:"500","show-word-limit":"",rows:3},model:{value:t.updateNavigationForm.description,callback:function(a){t.$set(t.updateNavigationForm,"description",a)},expression:"updateNavigationForm.description"}})],1),t._v(" "),e("el-form-item",{attrs:{prop:"target",label:"打开方式",error:t.updateError.target?t.updateError.target[0]:""}},[e("el-radio",{attrs:{label:"_self"},model:{value:t.updateNavigationForm.target,callback:function(a){t.$set(t.updateNavigationForm,"target",a)},expression:"updateNavigationForm.target"}},[t._v("当前窗口")]),t._v(" "),e("el-radio",{attrs:{label:"_blank"},model:{value:t.updateNavigationForm.target,callback:function(a){t.$set(t.updateNavigationForm,"target",a)},expression:"updateNavigationForm.target"}},[t._v("新建窗口")])],1),t._v(" "),e("el-form-item",{attrs:{prop:"published",label:"状态",error:t.updateError.published?t.updateError.published[0]:""}},[e("el-switch",{attrs:{"active-value":1,"inactive-value":0},model:{value:t.updateNavigationForm.published,callback:function(a){t.$set(t.updateNavigationForm,"published",a)},expression:"updateNavigationForm.published"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(a){t.updateNavigationVisible=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary",loading:t.updateLoading},on:{click:function(a){return t.updateNavigation("updateForm")}}},[t._v("保存")])],1)],1)],1)],1)}),[],!1,null,null,null).exports}}]);